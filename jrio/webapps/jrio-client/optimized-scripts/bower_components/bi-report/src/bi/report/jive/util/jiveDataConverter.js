define(["require","jquery","underscore","common/util/parse/NumberUtils","common/util/parse/date","common/util/parse/time","jquery-ui/jquery.ui.datepicker","jquery-ui/jquery.ui.timepicker"],function(e){"use strict";var t=e("jquery"),r=e("underscore"),i=e("common/util/parse/NumberUtils"),a=(new i,e("common/util/parse/date")),n=e("common/util/parse/time");e("jquery-ui/jquery.ui.datepicker"),e("jquery-ui/jquery.ui.timepicker");var o={DURATION_PATTERN:"[h]:mm:ss",jQueryUiTimestampToIsoTimestamp:function(e,r){if(e&&e.trim().length&&r&&r.calendarPatterns){var i=r.calendarPatterns.date,n=r.calendarPatterns.time;return a.dateObjectToIso8601Timestamp(t.datepicker.parseDateTime(i,n,e))}},jQueryUiTimeToIsoTime:function(e,r){if(e&&e.trim().length&&r&&r.calendarPatterns){var i=r.calendarPatterns.time,a=t.datepicker.parseTime(i,e);if(a)return n.timeToIso8061Time(a.hour,a.minute,a.second)}},isoTimestampTojQueryUiTimestamp:function(e,r){if(e&&e.trim().length&&r&&r.calendarPatterns){var i=a.iso8601TimestampToDateObject(e),n=r.calendarPatterns.date,o=r.calendarPatterns.time,_=t.timepicker&&t.timepicker._defaults&&t.timepicker._defaults.separator?t.timepicker._defaults.separator:" ",m=t.datepicker.formatDate(n,i),T=t.datepicker.formatTime(o,{hour:i.getHours(),minute:i.getMinutes(),second:i.getSeconds()});return m+_+T}},isoTimeTojQueryUiTime:function(e,r){if(r&&r.calendarPatterns){var i=n.iso8601TimeToTimeObject(e),a=r.calendarPatterns.time;if(i)return t.datepicker.formatTime(a,{hour:i.hours,minute:i.minutes,second:i.seconds})}},filterStartValue:function(e,t,i,a){var n=null==t&&null==e,_="boolean"===i,m="datetime"===i,T="time"===i;return n?"":r.isArray(t)?m?o.isoTimestampTojQueryUiTimestamp(t[0],a):T?o.isoTimeTojQueryUiTime(t[0],a):t[0]:_?"":m?o.isoTimestampTojQueryUiTimestamp(t,a):T?o.isoTimeTojQueryUiTime(t,a):t},filterEndValue:function(e,t,i,a){var n=null==t&&null==e,_="datetime"===i,m="time"===i;return n?"":r.isArray(t)?_?o.isoTimestampTojQueryUiTimestamp(t[1],a):m?o.isoTimeTojQueryUiTime(t[1],a):t[1]:""},dataTypeToSchemaFormat:{Text:"string",Numeric:"numeric",Date:"datetime",Boolean:"boolean",Time:"time"},schemaFormatOperatorToFilterOperatorMap:function(){var e={};return e.string={},e.string.equal="EQUALS",e.string.not_equal="IS_NOT_EQUAL_TO",e.string.contain="CONTAINS",e.string.not_contain="DOES_NOT_CONTAIN",e.string.start_with="STARTS_WITH",e.string.not_start_with="DOES_NOT_START_WITH",e.string.end_with="ENDS_WITH",e.string.not_end_with="DOES_NOT_END_WITH",e.datetime={},e.datetime.equal="EQUALS",e.datetime.not_equal="IS_NOT_EQUAL_TO",e.datetime.between="IS_BETWEEN",e.datetime.not_between="IS_NOT_BETWEEN",e.datetime.on_or_before="IS_ON_OR_BEFORE",e.datetime.before="IS_BEFORE",e.datetime.on_or_after="IS_ON_OR_AFTER",e.datetime.after="IS_AFTER",e.time={},e.time.equal="EQUALS",e.time.not_equal="IS_NOT_EQUAL_TO",e.time.between="IS_BETWEEN",e.time.not_between="IS_NOT_BETWEEN",e.time.on_or_before="IS_ON_OR_BEFORE",e.time.before="IS_BEFORE",e.time.on_or_after="IS_ON_OR_AFTER",e.time.after="IS_AFTER",e.numeric={},e.numeric.equal="EQUALS",e.numeric.not_equal="DOES_NOT_EQUAL",e.numeric.greater="GREATER_THAN",e.numeric.greater_or_equal="GREATER_THAN_EQUAL_TO",e.numeric.less="LESS_THAN",e.numeric.less_or_equal="LESS_THAN_EQUAL_TO",e.numeric.between="IS_BETWEEN",e.numeric.not_between="IS_NOT_BETWEEN",e}(),filterOperatorToSchemaFormatMap:function(){var e={};return e.string={},e.string.EQUALS="equal",e.string.IS_NOT_EQUAL_TO="not_equal",e.string.CONTAINS="contain",e.string.DOES_NOT_CONTAIN="not_contain",e.string.STARTS_WITH="start_with",e.string.DOES_NOT_START_WITH="not_start_with",e.string.ENDS_WITH="end_with",e.string.DOES_NOT_END_WITH="not_end_with",e.datetime={},e.datetime.EQUALS="equal",e.datetime.IS_NOT_EQUAL_TO="not_equal",e.datetime.IS_BETWEEN="between",e.datetime.IS_NOT_BETWEEN="not_between",e.datetime.IS_ON_OR_BEFORE="on_or_before",e.datetime.IS_BEFORE="before",e.datetime.IS_ON_OR_AFTER="on_or_after",e.datetime.IS_AFTER="after",e.numeric={},e.numeric.EQUALS="equal",e.numeric.DOES_NOT_EQUAL="not_equal",e.numeric.GREATER_THAN="greater",e.numeric.GREATER_THAN_EQUAL_TO="greater_or_equal",e.numeric.LESS_THAN="less",e.numeric.LESS_THAN_EQUAL_TO="less_or_equal",e.numeric.IS_BETWEEN="between",e.numeric.IS_NOT_BETWEEN="not_between",e.time={},e.time.EQUALS="equal",e.time.IS_NOT_EQUAL_TO="not_equal",e.time.IS_BETWEEN="between",e.time.IS_NOT_BETWEEN="not_between",e.time.IS_ON_OR_BEFORE="on_or_before",e.time.IS_BEFORE="before",e.time.IS_ON_OR_AFTER="on_or_after",e.time.IS_AFTER="after",e}(),schemaFormatOperatorToFilterOperator:function(e,t,r){return"boolean"!==r?o.schemaFormatOperatorToFilterOperatorMap[r][e]:"equal"===e&&t===!0?"IS_TRUE":"equal"===e&&t===!1?"IS_FALSE":"not_equal"===e&&t===!0?"IS_NOT_TRUE":"not_equal"===e&&t===!1?"IS_NOT_FALSE":void 0},operatorAndValueToSchemaFormat:function(e,t,r,i,a){var n={};if("boolean"===t)"IS_TRUE"===e?(n.operator="equal",n.value=!0):"IS_FALSE"===e?(n.operator="equal",n.value=!1):"IS_NOT_TRUE"===e?(n.operator="not_equal",n.value=!0):"IS_NOT_FALSE"===e&&(n.operator="not_equal",n.value=!1);else{n.operator=o.filterOperatorToSchemaFormatMap[t][e];var _="between"===n.operator||"not_between"===n.operator;if("string"===t)n.value=r;else if("numeric"===t)try{_?n.value=[r,i]:n.value=r}catch(m){throw new Error("Cannot convert filter value to number",m)}else{var T=this.parent&&this.parent.config?this.parent.config.genericProperties:void 0;"datetime"===t?_?n.value=[o.jQueryUiTimestampToIsoTimestamp(r,T),o.jQueryUiTimestampToIsoTimestamp(i,T)]:n.value=o.jQueryUiTimestampToIsoTimestamp(r,T):"time"===t&&(_?n.value=[o.jQueryUiTimeToIsoTime(r,T),o.jQueryUiTimeToIsoTime(i,T)]:n.value=o.jQueryUiTimeToIsoTime(r,T))}}return n}};return o});